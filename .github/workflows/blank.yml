name: test

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 1440
    steps:
      # 在这里定义您的步骤
    - name: Download
      run: Invoke-WebRequest "https://drive.usercontent.google.com/u/0/uc?id=1uGvhLPEXQHBGCEBkEWI0bodKVlu5UfWs&export=download" -OutFile test.zip
    - name: Extract
      run: Expand-Archive test.zip
    - name: Enable TS
      run: Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server'-name "fDenyTSConnections" -Value 0
    - run: Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
    - run: Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "UserAuthentication" -Value 1
    - run: Set-LocalUser -Name "runneradmin" -Password (ConvertTo-SecureString -AsPlainText "9xprZ5KW*0!WK3(le=!DEdJPJrXc)F3X" -Force)
    - run: Set-WinUserLanguageList -LanguageList zh_CN, en-US -Force
   
            
      
    - name: test
      run: |
           Start-Process -FilePath "ssh" -ArgumentList "-fNR 13389:localhost:3389  -i ./id_ed25519 -o StrictHostKeyChecking=no -o serveraliveinterval=60  root@chinassh.ddns.net -p2323"
            Start-Sleep -s 21800
